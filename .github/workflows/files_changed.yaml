# If any file in input folder_path was changed then return true else return false
# echo all changed files
# for PUSH event - compare current commit with previous commit
# for PULL_REQUEST event - compare source branch with target branch
name: If files in folder_path were changed

on:
  workflow_call:
    inputs:
      folder_path:
        required: true
        type: string

jobs:
  if-file-changed:
    name: Check if files changed
    runs-on: ubuntu-latest
    outputs:
      folder_changed: ${{ steps.get_boolean_output.outputs.output }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # fetch all history of all branches
      - name: Get files changed on push
        # if push on dev or master or main then get diff between current and previous commit
        if: github.event_name=='push' && contains(fromJson('["dev", "master","main"]'), github.ref_name)
        id: files_changed_on_push
        run: |
          all_changed_files=$(git --no-pager diff --name-only ${{ github.event.before }} ${{ github.sha }})
          echo all files changed are - 
          echo $all_changed_files
          
          echo "::set-output name=boolean_output::false"
          for file in $all_changed_files; do
           if [[ $file == ${{inputs.folder_path}} ]]; then
             echo "$file"
             echo "::set-output name=boolean_output::true"
             break
           fi
          done


      - name: Git files changed when pr is created/updated
        if: github.event_name=='pull_request'
        id: files_changed_on_pr
        run: |
          git --no-pager diff --name-only ${{github.head_ref}} ${{github.base_ref}}

      - name: Get combined boolean output
        # if request is PUSH or PR , get appropriate boolean_output
        id: get_boolean_output
        run: |
          echo "::set-output name=output::false"
          if [[ ${{steps.files_changed_on_push.boolean_output}} == true ]] || [[ ${{steps.files_changed_on_pr.boolean_output}} == true ]]; then
           echo "::set-output name=output::true"
          fi

          
